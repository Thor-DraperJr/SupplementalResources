## 3 Manage security operations (25-30%)

### 3.1 Monitor security by using Azure Monitor

#### 3.1.1 create and customize alerts
Alerts proactively notify you when issues are found with your infrastructure or application using your monitoring data in Azure Monitor. They allow you to identify and address issues before the users of your system notice them.

Alert rules are separated from alerts and the actions taken when an alert fires. The alert rule captures the target and criteria for alerting. The alert rule can be in an enabled or a disabled state. Alerts only fire when enabled.

The following are key attributes of an alert rule:

**Target Resource** - Defines the scope and signals available for alerting. A target can be any Azure resource. Example targets:

* Virtual machines.
* Storage accounts.
* Log Analytics workspace.
* Application Insights.
For certain resources (like virtual machines), you can specify multiple resources as the target of the alert rule.

**Signal** - Emitted by the target resource. Signals can be of the following types: metric, activity log, Application Insights, and log.

**Criteria** - A combination of signal and logic applied on a target resource. Examples:

* Percentage CPU > 70%
* Server Response Time > 4 ms
* Result count of a log query > 100
**Alert Name** - A specific name for the alert rule configured by the user.

**Alert Description** - A description for the alert rule configured by the user.

**Severity** - The severity of the alert after the criteria specified in the alert rule is met. Severity can range from 0 to 4.

* Sev 0 = Critical
* Sev 1 = Error
* Sev 2 = Warning
* Sev 3 = Informational
* Sev 4 = Verbose
**Action** - A specific action taken when the alert is fired.

[What are alerts in Microsoft Azure?](https://docs.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-overview)
#### 3.1.2 monitor security logs by using Azure Monitor
Security logging and monitoring focuses on activities related to enabling, acquiring, and storing audit logs for Azure services.
1. Use approved time synchronization sources
Microsoft maintains time sources for Azure resources, however, you have the option to manage the time synchronization settings for your compute resources.
2. Configure central security log management
Ingest logs via Azure Monitor to aggregate security data generated by endpoint devices, network resources, and other security systems. Within Azure Monitor, use Log Analytics Workspace(s) to query and perform analytics, and use Azure Storage Accounts for long-term/archival storage.

Alternatively, you may enable and on-board data to Azure Sentinel or a third-party SIEM.
3. Enable audit logging for Azure resources
Enable Diagnostic Settings on Azure resources for access to audit, security, and diagnostic logs. Activity logs, which are automatically available, include event source, date, user, timestamp, source addresses, destination addresses, and other useful elements.
4. Collect security logs from operating systems
If the compute resource is owned by Microsoft, then Microsoft is responsible for monitoring it. If the compute resource is owned by your organization, it's your responsibility to monitor it. You can use Azure Security Center to monitor the OS. Data collected by Security Center from the operating system includes OS type and version, OS (Windows Event Logs), running processes, machine name, IP addresses, and logged in user. The Log Analytics Agent also collects crash dump files.
5. Configure security log storage retention
Within Azure Monitor, set your Log Analytics Workspace retention period according to your organization's compliance regulations. Use Azure Storage Accounts for long-term/archival storage.
6. Monitor and review Logs
Analyze and monitor logs for anomalous behavior and regularly review results. Use Azure Monitor's Log Analytics Workspace to review logs and perform queries on log data.

Alternatively, you may enable and on-board data to Azure Sentinel or a third party SIEM.

7. Enable alerts for anomalous activities
Use Azure Security Center with Log Analytics Workspace for monitoring and alerting on anomalous activity found in security logs and events.

Alternatively, you may enable and on-board data to Azure Sentinel.
8. Centralize anti-malware logging
Enable antimalware event collection for Azure Virtual Machines and Cloud Services.
9. Enable DNS query logging
Implement a third-party solution from Azure Marketplace for DNS logging solution as per your organizations need.
10. Enable command-line audit logging
Use Microsoft Monitoring Agent on all supported Azure Windows virtual machines to log the process creation event and the CommandLine field. For supported Azure Linux Virtual machines, you can manually configure console logging on a per-node basis and use Syslog to store the data. Also, use Azure Monitor's Log Analytics workspace to review logs and perform queries on logged data from Azure Virtual machines.


[Security Control: Logging and Monitoring](https://docs.microsoft.com/en-us/security/benchmark/azure/security-control-logging-monitoring)
---
Home > Azure Sentinel workspaces > Azure Sentinel | Incidents > Incident
- use the investigate button

The investigation graph provides you with:

* Visual context from raw data - The live, visual graph displays entity relationships extracted automatically from the raw data. This enables you to easily see connections across different data sources.

* Full investigation scope discovery - Expand your investigation scope using built-in exploration queries to surface the full scope of a breach.

* Built-in investigation steps - Use predefined exploration options to make sure you are asking the right questions in the face of a threat.

NOTE: You will only be able to investigate the incident if you used the entity mapping fields when you set up your analytic rule. The investigation graph requires that your original incident includes entities.
#### 3.1.3 configure diagnostic logging and log retention
- Each Azure resource requires its own diagnostic setting, which defines the following criteria:
    - Categories of logs and metric data sent to the destinations defined in the setting. The available categories will vary for different resource types.
    - One or more destinations to send the logs. Current destinations include Log
    - A single diagnostic setting can define no more than one of each of the destinations. If you want to send data to more than one of a particular destination type (for example, two different Log Analytics workspaces), then create multiple settings. Each resource can have up to 5 diagnostic settings.

- Destinations
    - Platform logs and metrics can be sent to the destinations in the following list:
    - Log Analytics workspace	- Collecting logs and metrics into a Log Analytics workspace allows you to analyze them with other monitoring data collected by Azure Monitor using powerful log queries and also to leverage other Azure Monitor features such as alerts and visualizations.
    - Event hubs - Sending logs and metrics to Event Hubs allows you to stream data to external systems such as third-party SIEMs and other log analytics solutions.
    - Azure storage account - Archiving logs and metrics to an Azure storage account is useful for audit, static analysis, or backup. Compared to Azure Monitor Logs and a Log Analytics workspace, Azure storage is less expensive and logs can be kept there indefinitely.

- Data retention
    - 30 Days to 730 (2 years)
### 3.2 Monitor security by using Azure Security Center

#### 3.2.1 evaluate vulnerability scans from Azure Security Center
The vulnerability scanner included with Azure Security Center is powered by Qualys. It is only available to users on the standard pricing tier. You do not need a Qualys license or even a Qualys account - everything's handled seamlessly inside Security Center.

Your VMs will appear in one or more of the following groups:
* Healthy resources – the vulnerability scanner extension has been deployed to these VMs.
* Unhealthy resources – the vulnerability scanner extension can be deployed to these VMs.
* Not applicable resources – these VMs cannot have the vulnerability scanner extension deployed.

- Click Remdiate to change the VM

Security Center > Resource Security Hygiene | Recommendations > This will bring broad remediation across the domain

* What is scanned by the built-in vulnerability scanner?

The scanner is running on your virtual machine and looking for vulnerabilities of the VM itself. From the virtual machine, it cannot scan your network.

* Does the scanner integrate with my existing Qualys console?

The Security Center extension is a separate tool from your existing Qualys scanner. Licensing restrictions mean that it can only be used within Azure Security Center.

* How do I View and remediate discovered vulnerabilities? -

When Security Center identifies vulnerabilities, it presents findings and related information as recommendations. The related information includes remediation steps, related CVEs, CVSS scores, and more. You can view the identified vulnerabilities for one or more subscriptions, or for a specific VM.
#### 3.2.2 configure Just in Time VM access by using Azure Security Center
#### 3.2.3 configure compliance policies and evaluate for compliance by using Azure Security Center
#### 3.2.4 configure workflow automation by using Azure Security Center

### 3.3 Monitor security by using Azure Sentinel
- very similar to SCOM (system center operations manager); intune, log analytic capabilities, agent based monitoring

- Just a few examples of what you can do with Azure Monitor include:
    - Detect and diagnose issues across applications and dependencies with Application Insights
    - Correlate infrastructure issues with Azure Monitor for VMs and Azure Monitor for Containers
    - Drill into your monitoring data with Log Analytics for troubleshooting and deep diagnostics
    - Support operations at scale with smart alerts and automated actions 
    - Create visualizations with Azure dashboards and workbooks
        - NOTE: This service supports Azure delegated resource management, which lets service providers sign in to their own tenant to manage subscriptions and resource groups that customers have delegated.

    **Azure Monitor** *Charges by ingestion amounts and retention amounts*

- All data collected by Azure Monitor fits into one of two fundamental types, metrics and logs.
    - Metrics are numerical values that describe some aspect of a system at a particular point in time. They are lightweight and capable of supporting near real-time scenarios.
    - Logs contain different kinds of data organized into records with different sets of properties for each type. Telemetry such as events and traces are stored as logs in addition to performance data so that it can all be combined for analysis.

- What data does Azure Monitor collect?
    - Azure Monitor can collect data from a variety of sources. You can think of monitoring data for your applications in tiers ranging from your application, any operating system and services it relies on, down to the platform itself.
    - Azure Monitor collects data from each of the following tiers:
        - Application monitoring data - Data about the performance and functionality of the code you have written, regardless of its platform.
            - Guest OS monitoring data - Data about the operating system on which your application is running. This could be running in Azure, another cloud, or on-premises.
            - Azure resource monitoring data - Data about the operation of an Azure resource.
            - Azure subscription monitoring data - Data about the operation and management of an Azure subscription, as well as data about the health and operation of Azure itself.
            - Azure tenant monitoring data - Data about the operation of tenant-level Azure services, such as Azure Active Directory.
                - NOTE: Azure Monitor can collect log data from any REST client using the Data Collector API. This allows you to create custom monitoring scenarios and extend monitoring to resources that do not expose telemetry through other sources.
#### 3.3.1 create and customize alerts
Monitor > Monitor | Alerts

Create alert rule > Scope (Select a resource, and the hierarchy is applied) > Condition > Add action group (select security group and determine an action) > Alert rule details (name, description)

**You can only define one Activity Log signal per alert rule. To alert on more signals, create additional rules**

* Log Alerts: With the visualization in place, Alert Logic can be selected from shown options of Condition, Aggregation and finally Threshold. Finally specify in the logic, the time to assess for the specified condition, using Period option. Along with how often Alert should run by selecting Frequency. Log Alerts can be based on:
 * Number of Records: An alert is created if the count of records returned by the query is either greater than or less than the value provided.
 * Metric Measurement: An alert is created if each aggregate value in the results exceeds the threshold value provided and it is grouped by chosen value. The number of breaches for an alert is the number of times the threshold is exceeded in the chosen time period. You can specify Total breaches for any combination of breaches across the results set or Consecutive breaches to require that the breaches must occur in consecutive samples.
 * *For Log Alerts only, some additional functionality is available in Alert details:*
  * Suppress Alerts: When you turn on suppression for the alert rule, actions
for the rule are disabled for a defined length of time after creating a new alert. The rule is still running and creates alert records provided the criteria is met. Allowing you time to correct the problem without running duplicate actions.
#### 3.3.2 configure data sources to Azure Sentinel
#### 3.3.3 evaluate results from Azure Sentinel
#### 3.3.4 configure a playbook by using Azure Sentinel
Microsoft Azure Sentinel is a scalable, cloud-native, security information event management (SIEM) and security orchestration automated response (SOAR) solution. Azure Sentinel delivers intelligent security analytics and threat intelligence across the enterprise, providing a single solution for alert detection, threat visibility, proactive hunting, and threat response.

What can Azure Sentinel do?
* Collect data at cloud scale across all users, devices, applications, and infrastructure, both on-premises and in multiple clouds.
* Detect previously undetected threats, and minimize false positives using Microsoft's analytics and unparalleled threat intelligence.
* Investigate threats with artificial intelligence, and hunt for suspicious activities at scale, tapping into years of cyber security work at Microsoft.
* Respond to incidents rapidly with built-in orchestration and automation of common tasks.

Sentinel uses data connectors within the Azure and 365 fabric to pull data, conduct analysis, and use playbooks to automate remediation

- _connectors_ = template to injest elements from on solution to sentinel (come with workbooks, queries, etc)
- _playbook_ = logic app; you can use logic app designer

### 3.4 Configure security policies

#### 3.4.1 configure security settings by using Azure Policy
#### 3.4.2 configure security settings by using Azure Blueprint